{"ast":null,"code":"/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\nimport * as tslib_1 from \"tslib\";\nimport { GraphErrorHandler } from \"./GraphErrorHandler\";\nimport { oDataQueryNames, serializeContent, urlJoin } from \"./GraphRequestUtil\";\nimport { GraphResponseHandler } from \"./GraphResponseHandler\";\nimport { MiddlewareControl } from \"./middleware/MiddlewareControl\";\nimport { RequestMethod } from \"./RequestMethod\";\nimport { ResponseType } from \"./ResponseType\";\n/**\r\n * @class\r\n * A Class representing GraphRequest\r\n */\n\nexport class GraphRequest {\n  /* tslint:enable: variable-name */\n\n  /**\r\n   * @public\r\n   * @constructor\r\n   * Creates an instance of GraphRequest\r\n   * @param {HTTPClient} httpClient - The HTTPClient instance\r\n   * @param {ClientOptions} config - The options for making request\r\n   * @param {string} path - A path string\r\n   */\n  constructor(httpClient, config, path) {\n    /**\r\n     * @private\r\n     * Parses the path string and creates URLComponents out of it\r\n     * @param {string} path - The request path string\r\n     * @returns Nothing\r\n     */\n    this.parsePath = path => {\n      // Strips out the base of the url if they passed in\n      if (path.indexOf(\"https://\") !== -1) {\n        path = path.replace(\"https://\", \"\"); // Find where the host ends\n\n        const endOfHostStrPos = path.indexOf(\"/\");\n\n        if (endOfHostStrPos !== -1) {\n          // Parse out the host\n          this.urlComponents.host = \"https://\" + path.substring(0, endOfHostStrPos); // Strip the host from path\n\n          path = path.substring(endOfHostStrPos + 1, path.length);\n        } // Remove the following version\n\n\n        const endOfVersionStrPos = path.indexOf(\"/\");\n\n        if (endOfVersionStrPos !== -1) {\n          // Parse out the version\n          this.urlComponents.version = path.substring(0, endOfVersionStrPos); // Strip version from path\n\n          path = path.substring(endOfVersionStrPos + 1, path.length);\n        }\n      } // Strip out any leading \"/\"\n\n\n      if (path.charAt(0) === \"/\") {\n        path = path.substr(1);\n      }\n\n      const queryStrPos = path.indexOf(\"?\");\n\n      if (queryStrPos === -1) {\n        // No query string\n        this.urlComponents.path = path;\n      } else {\n        this.urlComponents.path = path.substr(0, queryStrPos); // Capture query string into oDataQueryParams and otherURLQueryParams\n\n        const queryParams = path.substring(queryStrPos + 1, path.length).split(\"&\");\n\n        for (const queryParam of queryParams) {\n          const qParams = queryParam.split(\"=\");\n          const key = qParams[0];\n          const value = qParams[1];\n\n          if (oDataQueryNames.indexOf(key) !== -1) {\n            this.urlComponents.oDataQueryParams[key] = value;\n          } else {\n            this.urlComponents.otherURLQueryParams[key] = value;\n          }\n        }\n      }\n    };\n\n    this.httpClient = httpClient;\n    this.config = config;\n    this.urlComponents = {\n      host: this.config.baseUrl,\n      version: this.config.defaultVersion,\n      oDataQueryParams: {},\n      otherURLQueryParams: {}\n    };\n    this._headers = {};\n    this._options = {};\n    this._middlewareOptions = [];\n    this.parsePath(path);\n  }\n  /**\r\n   * @private\r\n   * Adds the query parameter as comma separated values\r\n   * @param {string} propertyName - The name of a property\r\n   * @param {string|string[]} propertyValue - The vale of a property\r\n   * @param {IArguments} additionalProperties - The additional properties\r\n   * @returns Nothing\r\n   */\n\n\n  addCsvQueryParameter(propertyName, propertyValue, additionalProperties) {\n    // If there are already $propertyName value there, append a \",\"\n    this.urlComponents.oDataQueryParams[propertyName] = this.urlComponents.oDataQueryParams[propertyName] ? this.urlComponents.oDataQueryParams[propertyName] + \",\" : \"\";\n    let allValues = [];\n\n    if (additionalProperties.length > 1 && typeof propertyValue === \"string\") {\n      allValues = Array.prototype.slice.call(additionalProperties);\n    } else if (typeof propertyValue === \"string\") {\n      allValues.push(propertyValue);\n    } else {\n      allValues = allValues.concat(propertyValue);\n    }\n\n    this.urlComponents.oDataQueryParams[propertyName] += allValues.join(\",\");\n  }\n  /**\r\n   * @private\r\n   * Builds the full url from the URLComponents to make a request\r\n   * @returns The URL string that is qualified to make a request to graph endpoint\r\n   */\n\n\n  buildFullUrl() {\n    const url = urlJoin([this.urlComponents.host, this.urlComponents.version, this.urlComponents.path]) + this.createQueryString();\n\n    if (this.config.debugLogging) {\n      console.log(url); // tslint:disable-line: no-console\n    }\n\n    return url;\n  }\n  /**\r\n   * @private\r\n   * Builds the query string from the URLComponents\r\n   * @returns The Constructed query string\r\n   */\n\n\n  createQueryString() {\n    // Combining query params from oDataQueryParams and otherURLQueryParams\n    const urlComponents = this.urlComponents;\n    const query = [];\n\n    if (Object.keys(urlComponents.oDataQueryParams).length !== 0) {\n      for (const property in urlComponents.oDataQueryParams) {\n        if (urlComponents.oDataQueryParams.hasOwnProperty(property)) {\n          query.push(property + \"=\" + urlComponents.oDataQueryParams[property]);\n        }\n      }\n    }\n\n    if (Object.keys(urlComponents.otherURLQueryParams).length !== 0) {\n      for (const property in urlComponents.otherURLQueryParams) {\n        if (urlComponents.otherURLQueryParams.hasOwnProperty(property)) {\n          query.push(property + \"=\" + urlComponents.otherURLQueryParams[property]);\n        }\n      }\n    }\n\n    return query.length > 0 ? \"?\" + query.join(\"&\") : \"\";\n  }\n  /**\r\n   * @private\r\n   * Updates the custom headers and options for a request\r\n   * @param {FetchOptions} options - The request options object\r\n   * @returns Nothing\r\n   */\n\n\n  updateRequestOptions(options) {\n    const optionsHeaders = Object.assign({}, options.headers);\n\n    if (this.config.fetchOptions !== undefined) {\n      const fetchOptions = Object.assign({}, this.config.fetchOptions);\n      Object.assign(options, fetchOptions);\n\n      if (typeof this.config.fetchOptions.headers !== undefined) {\n        options.headers = Object.assign({}, this.config.fetchOptions.headers);\n      }\n    }\n\n    Object.assign(options, this._options);\n\n    if (options.headers !== undefined) {\n      Object.assign(optionsHeaders, options.headers);\n    }\n\n    Object.assign(optionsHeaders, this._headers);\n    options.headers = optionsHeaders;\n  }\n  /**\r\n   * @private\r\n   * @async\r\n   * Adds the custom headers and options to the request and makes the HTTPClient send request call\r\n   * @param {RequestInfo} request - The request url string or the Request object value\r\n   * @param {FetchOptions} options - The options to make a request\r\n   * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n   * @returns A promise that resolves to the response content\r\n   */\n\n\n  send(request, options, callback) {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      let rawResponse;\n      const middlewareControl = new MiddlewareControl(this._middlewareOptions);\n      this.updateRequestOptions(options);\n\n      try {\n        const context = yield this.httpClient.sendRequest({\n          request,\n          options,\n          middlewareControl\n        });\n        rawResponse = context.response;\n        const response = yield GraphResponseHandler.getResponse(rawResponse, this._responseType, callback);\n        return response;\n      } catch (error) {\n        let statusCode;\n\n        if (typeof rawResponse !== \"undefined\") {\n          statusCode = rawResponse.status;\n        }\n\n        const gError = yield GraphErrorHandler.getError(error, statusCode, callback);\n        throw gError;\n      }\n    });\n  }\n  /**\r\n   * @public\r\n   * Sets the custom header for a request\r\n   * @param {string} headerKey - A header key\r\n   * @param {string} headerValue - A header value\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  header(headerKey, headerValue) {\n    this._headers[headerKey] = headerValue;\n    return this;\n  }\n  /**\r\n   * @public\r\n   * Sets the custom headers for a request\r\n   * @param {KeyValuePairObjectStringNumber} headers - The headers key value pair object\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  headers(headers) {\n    for (const key in headers) {\n      if (headers.hasOwnProperty(key)) {\n        this._headers[key] = headers[key];\n      }\n    }\n\n    return this;\n  }\n  /**\r\n   * @public\r\n   * Sets the option for making a request\r\n   * @param {string} key - The key value\r\n   * @param {any} value - The value\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  option(key, value) {\n    this._options[key] = value;\n    return this;\n  }\n  /**\r\n   * @public\r\n   * Sets the options for making a request\r\n   * @param {{ [key: string]: any }} options - The options key value pair\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  options(options) {\n    for (const key in options) {\n      if (options.hasOwnProperty(key)) {\n        this._options[key] = options[key];\n      }\n    }\n\n    return this;\n  }\n  /**\r\n   * @public\r\n   * Sets the middleware options for a request\r\n   * @param {MiddlewareOptions[]} options - The array of middleware options\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  middlewareOptions(options) {\n    this._middlewareOptions = options;\n    return this;\n  }\n  /**\r\n   * @public\r\n   * Sets the api endpoint version for a request\r\n   * @param {string} version - The version value\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  version(version) {\n    this.urlComponents.version = version;\n    return this;\n  }\n  /**\r\n   * @public\r\n   * Sets the api endpoint version for a request\r\n   * @param {ResponseType} responseType - The response type value\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  responseType(responseType) {\n    this._responseType = responseType;\n    return this;\n  }\n  /**\r\n   * @public\r\n   * To add properties for select OData Query param\r\n   * @param {string|string[]} properties - The Properties value\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n  /*\r\n   * Accepts .select(\"displayName,birthday\")\r\n   *     and .select([\"displayName\", \"birthday\"])\r\n   *     and .select(\"displayName\", \"birthday\")\r\n   *\r\n   */\n\n\n  select(properties) {\n    this.addCsvQueryParameter(\"$select\", properties, arguments);\n    return this;\n  }\n  /**\r\n   * @public\r\n   * To add properties for expand OData Query param\r\n   * @param {string|string[]} properties - The Properties value\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  expand(properties) {\n    this.addCsvQueryParameter(\"$expand\", properties, arguments);\n    return this;\n  }\n  /**\r\n   * @public\r\n   * To add properties for orderby OData Query param\r\n   * @param {string|string[]} properties - The Properties value\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  orderby(properties) {\n    this.addCsvQueryParameter(\"$orderby\", properties, arguments);\n    return this;\n  }\n  /**\r\n   * @public\r\n   * To add query string for filter OData Query param\r\n   * @param {string} filterStr - The filter query string\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  filter(filterStr) {\n    this.urlComponents.oDataQueryParams.$filter = filterStr;\n    return this;\n  }\n  /**\r\n   * @public\r\n   * To add criterion for search OData Query param\r\n   * @param {string} searchStr - The search criterion string\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  search(searchStr) {\n    this.urlComponents.oDataQueryParams.$search = searchStr;\n    return this;\n  }\n  /**\r\n   * @public\r\n   * To add number for top OData Query param\r\n   * @param {number} n - The number value\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  top(n) {\n    this.urlComponents.oDataQueryParams.$top = n;\n    return this;\n  }\n  /**\r\n   * @public\r\n   * To add number for skip OData Query param\r\n   * @param {number} n - The number value\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  skip(n) {\n    this.urlComponents.oDataQueryParams.$skip = n;\n    return this;\n  }\n  /**\r\n   * @public\r\n   * To add token string for skipToken OData Query param\r\n   * @param {string} token - The token value\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  skipToken(token) {\n    this.urlComponents.oDataQueryParams.$skipToken = token;\n    return this;\n  }\n  /**\r\n   * @public\r\n   * To add boolean for count OData Query param\r\n   * @param {boolean} isCount - The count boolean\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  count(isCount) {\n    this.urlComponents.oDataQueryParams.$count = isCount.toString();\n    return this;\n  }\n  /**\r\n   * @public\r\n   * Appends query string to the urlComponent\r\n   * @param {string|KeyValuePairObjectStringNumber} queryDictionaryOrString - The query value\r\n   * @returns The same GraphRequest instance that is being called with\r\n   */\n\n\n  query(queryDictionaryOrString) {\n    const otherURLQueryParams = this.urlComponents.otherURLQueryParams;\n\n    if (typeof queryDictionaryOrString === \"string\") {\n      const querySplit = queryDictionaryOrString.split(\"=\");\n      const queryKey = querySplit[0];\n      const queryValue = querySplit[1];\n      otherURLQueryParams[queryKey] = queryValue;\n    } else {\n      for (const key in queryDictionaryOrString) {\n        if (queryDictionaryOrString.hasOwnProperty(key)) {\n          otherURLQueryParams[key] = queryDictionaryOrString[key];\n        }\n      }\n    }\n\n    return this;\n  }\n  /**\r\n   * @public\r\n   * @async\r\n   * Makes a http request with GET method\r\n   * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n   * @returns A promise that resolves to the get response\r\n   */\n\n\n  get(callback) {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      const url = this.buildFullUrl();\n      const options = {\n        method: RequestMethod.GET\n      };\n\n      try {\n        const response = yield this.send(url, options, callback);\n        return response;\n      } catch (error) {\n        throw error;\n      }\n    });\n  }\n  /**\r\n   * @public\r\n   * @async\r\n   * Makes a http request with POST method\r\n   * @param {any} content - The content that needs to be sent with the request\r\n   * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n   * @returns A promise that resolves to the post response\r\n   */\n\n\n  post(content, callback) {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      const url = this.buildFullUrl();\n      const options = {\n        method: RequestMethod.POST,\n        body: serializeContent(content),\n        headers: typeof FormData !== \"undefined\" && content instanceof FormData ? {} : {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n\n      try {\n        const response = yield this.send(url, options, callback);\n        return response;\n      } catch (error) {\n        throw error;\n      }\n    });\n  }\n  /**\r\n   * @public\r\n   * @async\r\n   * Alias for Post request call\r\n   * @param {any} content - The content that needs to be sent with the request\r\n   * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n   * @returns A promise that resolves to the post response\r\n   */\n\n\n  create(content, callback) {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      try {\n        return yield this.post(content, callback);\n      } catch (error) {\n        throw error;\n      }\n    });\n  }\n  /**\r\n   * @public\r\n   * @async\r\n   * Makes http request with PUT method\r\n   * @param {any} content - The content that needs to be sent with the request\r\n   * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n   * @returns A promise that resolves to the put response\r\n   */\n\n\n  put(content, callback) {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      const url = this.buildFullUrl();\n      const options = {\n        method: RequestMethod.PUT,\n        body: serializeContent(content),\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n\n      try {\n        const response = yield this.send(url, options, callback);\n        return response;\n      } catch (error) {\n        throw error;\n      }\n    });\n  }\n  /**\r\n   * @public\r\n   * @async\r\n   * Makes http request with PATCH method\r\n   * @param {any} content - The content that needs to be sent with the request\r\n   * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n   * @returns A promise that resolves to the patch response\r\n   */\n\n\n  patch(content, callback) {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      const url = this.buildFullUrl();\n      const options = {\n        method: RequestMethod.PATCH,\n        body: serializeContent(content),\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n\n      try {\n        const response = yield this.send(url, options, callback);\n        return response;\n      } catch (error) {\n        throw error;\n      }\n    });\n  }\n  /**\r\n   * @public\r\n   * @async\r\n   * Alias for PATCH request\r\n   * @param {any} content - The content that needs to be sent with the request\r\n   * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n   * @returns A promise that resolves to the patch response\r\n   */\n\n\n  update(content, callback) {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      try {\n        return yield this.patch(content, callback);\n      } catch (error) {\n        throw error;\n      }\n    });\n  }\n  /**\r\n   * @public\r\n   * @async\r\n   * Makes http request with DELETE method\r\n   * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n   * @returns A promise that resolves to the delete response\r\n   */\n\n\n  delete(callback) {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      const url = this.buildFullUrl();\n      const options = {\n        method: RequestMethod.DELETE\n      };\n\n      try {\n        const response = yield this.send(url, options, callback);\n        return response;\n      } catch (error) {\n        throw error;\n      }\n    });\n  }\n  /**\r\n   * @public\r\n   * @async\r\n   * Alias for delete request call\r\n   * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n   * @returns A promise that resolves to the delete response\r\n   */\n\n\n  del(callback) {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      try {\n        return yield this.delete(callback);\n      } catch (error) {\n        throw error;\n      }\n    });\n  }\n  /**\r\n   * @public\r\n   * @async\r\n   * Makes a http request with GET method to read response as a stream.\r\n   * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n   * @returns A promise that resolves to the getStream response\r\n   */\n\n\n  getStream(callback) {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      const url = this.buildFullUrl();\n      const options = {\n        method: RequestMethod.GET\n      };\n      this.responseType(ResponseType.STREAM);\n\n      try {\n        const stream = yield this.send(url, options, callback);\n        return stream;\n      } catch (error) {\n        throw error;\n      }\n    });\n  }\n  /**\r\n   * @public\r\n   * @async\r\n   * Makes a http request with GET method to read response as a stream.\r\n   * @param {any} stream - The stream instance\r\n   * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n   * @returns A promise that resolves to the putStream response\r\n   */\n\n\n  putStream(stream, callback) {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      const url = this.buildFullUrl();\n      const options = {\n        method: RequestMethod.PUT,\n        headers: {\n          \"Content-Type\": \"application/octet-stream\"\n        },\n        body: stream\n      };\n\n      try {\n        const response = yield this.send(url, options, callback);\n        return response;\n      } catch (error) {\n        throw error;\n      }\n    });\n  }\n\n}","map":{"version":3,"sources":["../../src/GraphRequest.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\nimport * as tslib_1 from \"tslib\";\r\nimport { GraphErrorHandler } from \"./GraphErrorHandler\";\r\nimport { oDataQueryNames, serializeContent, urlJoin } from \"./GraphRequestUtil\";\r\nimport { GraphResponseHandler } from \"./GraphResponseHandler\";\r\nimport { MiddlewareControl } from \"./middleware/MiddlewareControl\";\r\nimport { RequestMethod } from \"./RequestMethod\";\r\nimport { ResponseType } from \"./ResponseType\";\r\n/**\r\n * @class\r\n * A Class representing GraphRequest\r\n */\r\nexport class GraphRequest {\r\n    /* tslint:enable: variable-name */\r\n    /**\r\n     * @public\r\n     * @constructor\r\n     * Creates an instance of GraphRequest\r\n     * @param {HTTPClient} httpClient - The HTTPClient instance\r\n     * @param {ClientOptions} config - The options for making request\r\n     * @param {string} path - A path string\r\n     */\r\n    constructor(httpClient, config, path) {\r\n        /**\r\n         * @private\r\n         * Parses the path string and creates URLComponents out of it\r\n         * @param {string} path - The request path string\r\n         * @returns Nothing\r\n         */\r\n        this.parsePath = (path) => {\r\n            // Strips out the base of the url if they passed in\r\n            if (path.indexOf(\"https://\") !== -1) {\r\n                path = path.replace(\"https://\", \"\");\r\n                // Find where the host ends\r\n                const endOfHostStrPos = path.indexOf(\"/\");\r\n                if (endOfHostStrPos !== -1) {\r\n                    // Parse out the host\r\n                    this.urlComponents.host = \"https://\" + path.substring(0, endOfHostStrPos);\r\n                    // Strip the host from path\r\n                    path = path.substring(endOfHostStrPos + 1, path.length);\r\n                }\r\n                // Remove the following version\r\n                const endOfVersionStrPos = path.indexOf(\"/\");\r\n                if (endOfVersionStrPos !== -1) {\r\n                    // Parse out the version\r\n                    this.urlComponents.version = path.substring(0, endOfVersionStrPos);\r\n                    // Strip version from path\r\n                    path = path.substring(endOfVersionStrPos + 1, path.length);\r\n                }\r\n            }\r\n            // Strip out any leading \"/\"\r\n            if (path.charAt(0) === \"/\") {\r\n                path = path.substr(1);\r\n            }\r\n            const queryStrPos = path.indexOf(\"?\");\r\n            if (queryStrPos === -1) {\r\n                // No query string\r\n                this.urlComponents.path = path;\r\n            }\r\n            else {\r\n                this.urlComponents.path = path.substr(0, queryStrPos);\r\n                // Capture query string into oDataQueryParams and otherURLQueryParams\r\n                const queryParams = path.substring(queryStrPos + 1, path.length).split(\"&\");\r\n                for (const queryParam of queryParams) {\r\n                    const qParams = queryParam.split(\"=\");\r\n                    const key = qParams[0];\r\n                    const value = qParams[1];\r\n                    if (oDataQueryNames.indexOf(key) !== -1) {\r\n                        this.urlComponents.oDataQueryParams[key] = value;\r\n                    }\r\n                    else {\r\n                        this.urlComponents.otherURLQueryParams[key] = value;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        this.httpClient = httpClient;\r\n        this.config = config;\r\n        this.urlComponents = {\r\n            host: this.config.baseUrl,\r\n            version: this.config.defaultVersion,\r\n            oDataQueryParams: {},\r\n            otherURLQueryParams: {},\r\n        };\r\n        this._headers = {};\r\n        this._options = {};\r\n        this._middlewareOptions = [];\r\n        this.parsePath(path);\r\n    }\r\n    /**\r\n     * @private\r\n     * Adds the query parameter as comma separated values\r\n     * @param {string} propertyName - The name of a property\r\n     * @param {string|string[]} propertyValue - The vale of a property\r\n     * @param {IArguments} additionalProperties - The additional properties\r\n     * @returns Nothing\r\n     */\r\n    addCsvQueryParameter(propertyName, propertyValue, additionalProperties) {\r\n        // If there are already $propertyName value there, append a \",\"\r\n        this.urlComponents.oDataQueryParams[propertyName] = this.urlComponents.oDataQueryParams[propertyName] ? this.urlComponents.oDataQueryParams[propertyName] + \",\" : \"\";\r\n        let allValues = [];\r\n        if (additionalProperties.length > 1 && typeof propertyValue === \"string\") {\r\n            allValues = Array.prototype.slice.call(additionalProperties);\r\n        }\r\n        else if (typeof propertyValue === \"string\") {\r\n            allValues.push(propertyValue);\r\n        }\r\n        else {\r\n            allValues = allValues.concat(propertyValue);\r\n        }\r\n        this.urlComponents.oDataQueryParams[propertyName] += allValues.join(\",\");\r\n    }\r\n    /**\r\n     * @private\r\n     * Builds the full url from the URLComponents to make a request\r\n     * @returns The URL string that is qualified to make a request to graph endpoint\r\n     */\r\n    buildFullUrl() {\r\n        const url = urlJoin([this.urlComponents.host, this.urlComponents.version, this.urlComponents.path]) + this.createQueryString();\r\n        if (this.config.debugLogging) {\r\n            console.log(url); // tslint:disable-line: no-console\r\n        }\r\n        return url;\r\n    }\r\n    /**\r\n     * @private\r\n     * Builds the query string from the URLComponents\r\n     * @returns The Constructed query string\r\n     */\r\n    createQueryString() {\r\n        // Combining query params from oDataQueryParams and otherURLQueryParams\r\n        const urlComponents = this.urlComponents;\r\n        const query = [];\r\n        if (Object.keys(urlComponents.oDataQueryParams).length !== 0) {\r\n            for (const property in urlComponents.oDataQueryParams) {\r\n                if (urlComponents.oDataQueryParams.hasOwnProperty(property)) {\r\n                    query.push(property + \"=\" + urlComponents.oDataQueryParams[property]);\r\n                }\r\n            }\r\n        }\r\n        if (Object.keys(urlComponents.otherURLQueryParams).length !== 0) {\r\n            for (const property in urlComponents.otherURLQueryParams) {\r\n                if (urlComponents.otherURLQueryParams.hasOwnProperty(property)) {\r\n                    query.push(property + \"=\" + urlComponents.otherURLQueryParams[property]);\r\n                }\r\n            }\r\n        }\r\n        return query.length > 0 ? \"?\" + query.join(\"&\") : \"\";\r\n    }\r\n    /**\r\n     * @private\r\n     * Updates the custom headers and options for a request\r\n     * @param {FetchOptions} options - The request options object\r\n     * @returns Nothing\r\n     */\r\n    updateRequestOptions(options) {\r\n        const optionsHeaders = Object.assign({}, options.headers);\r\n        if (this.config.fetchOptions !== undefined) {\r\n            const fetchOptions = Object.assign({}, this.config.fetchOptions);\r\n            Object.assign(options, fetchOptions);\r\n            if (typeof this.config.fetchOptions.headers !== undefined) {\r\n                options.headers = Object.assign({}, this.config.fetchOptions.headers);\r\n            }\r\n        }\r\n        Object.assign(options, this._options);\r\n        if (options.headers !== undefined) {\r\n            Object.assign(optionsHeaders, options.headers);\r\n        }\r\n        Object.assign(optionsHeaders, this._headers);\r\n        options.headers = optionsHeaders;\r\n    }\r\n    /**\r\n     * @private\r\n     * @async\r\n     * Adds the custom headers and options to the request and makes the HTTPClient send request call\r\n     * @param {RequestInfo} request - The request url string or the Request object value\r\n     * @param {FetchOptions} options - The options to make a request\r\n     * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n     * @returns A promise that resolves to the response content\r\n     */\r\n    send(request, options, callback) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\r\n            let rawResponse;\r\n            const middlewareControl = new MiddlewareControl(this._middlewareOptions);\r\n            this.updateRequestOptions(options);\r\n            try {\r\n                const context = yield this.httpClient.sendRequest({\r\n                    request,\r\n                    options,\r\n                    middlewareControl,\r\n                });\r\n                rawResponse = context.response;\r\n                const response = yield GraphResponseHandler.getResponse(rawResponse, this._responseType, callback);\r\n                return response;\r\n            }\r\n            catch (error) {\r\n                let statusCode;\r\n                if (typeof rawResponse !== \"undefined\") {\r\n                    statusCode = rawResponse.status;\r\n                }\r\n                const gError = yield GraphErrorHandler.getError(error, statusCode, callback);\r\n                throw gError;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * @public\r\n     * Sets the custom header for a request\r\n     * @param {string} headerKey - A header key\r\n     * @param {string} headerValue - A header value\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    header(headerKey, headerValue) {\r\n        this._headers[headerKey] = headerValue;\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * Sets the custom headers for a request\r\n     * @param {KeyValuePairObjectStringNumber} headers - The headers key value pair object\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    headers(headers) {\r\n        for (const key in headers) {\r\n            if (headers.hasOwnProperty(key)) {\r\n                this._headers[key] = headers[key];\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * Sets the option for making a request\r\n     * @param {string} key - The key value\r\n     * @param {any} value - The value\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    option(key, value) {\r\n        this._options[key] = value;\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * Sets the options for making a request\r\n     * @param {{ [key: string]: any }} options - The options key value pair\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    options(options) {\r\n        for (const key in options) {\r\n            if (options.hasOwnProperty(key)) {\r\n                this._options[key] = options[key];\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * Sets the middleware options for a request\r\n     * @param {MiddlewareOptions[]} options - The array of middleware options\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    middlewareOptions(options) {\r\n        this._middlewareOptions = options;\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * Sets the api endpoint version for a request\r\n     * @param {string} version - The version value\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    version(version) {\r\n        this.urlComponents.version = version;\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * Sets the api endpoint version for a request\r\n     * @param {ResponseType} responseType - The response type value\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    responseType(responseType) {\r\n        this._responseType = responseType;\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * To add properties for select OData Query param\r\n     * @param {string|string[]} properties - The Properties value\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    /*\r\n     * Accepts .select(\"displayName,birthday\")\r\n     *     and .select([\"displayName\", \"birthday\"])\r\n     *     and .select(\"displayName\", \"birthday\")\r\n     *\r\n     */\r\n    select(properties) {\r\n        this.addCsvQueryParameter(\"$select\", properties, arguments);\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * To add properties for expand OData Query param\r\n     * @param {string|string[]} properties - The Properties value\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    expand(properties) {\r\n        this.addCsvQueryParameter(\"$expand\", properties, arguments);\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * To add properties for orderby OData Query param\r\n     * @param {string|string[]} properties - The Properties value\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    orderby(properties) {\r\n        this.addCsvQueryParameter(\"$orderby\", properties, arguments);\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * To add query string for filter OData Query param\r\n     * @param {string} filterStr - The filter query string\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    filter(filterStr) {\r\n        this.urlComponents.oDataQueryParams.$filter = filterStr;\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * To add criterion for search OData Query param\r\n     * @param {string} searchStr - The search criterion string\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    search(searchStr) {\r\n        this.urlComponents.oDataQueryParams.$search = searchStr;\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * To add number for top OData Query param\r\n     * @param {number} n - The number value\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    top(n) {\r\n        this.urlComponents.oDataQueryParams.$top = n;\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * To add number for skip OData Query param\r\n     * @param {number} n - The number value\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    skip(n) {\r\n        this.urlComponents.oDataQueryParams.$skip = n;\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * To add token string for skipToken OData Query param\r\n     * @param {string} token - The token value\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    skipToken(token) {\r\n        this.urlComponents.oDataQueryParams.$skipToken = token;\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * To add boolean for count OData Query param\r\n     * @param {boolean} isCount - The count boolean\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    count(isCount) {\r\n        this.urlComponents.oDataQueryParams.$count = isCount.toString();\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * Appends query string to the urlComponent\r\n     * @param {string|KeyValuePairObjectStringNumber} queryDictionaryOrString - The query value\r\n     * @returns The same GraphRequest instance that is being called with\r\n     */\r\n    query(queryDictionaryOrString) {\r\n        const otherURLQueryParams = this.urlComponents.otherURLQueryParams;\r\n        if (typeof queryDictionaryOrString === \"string\") {\r\n            const querySplit = queryDictionaryOrString.split(\"=\");\r\n            const queryKey = querySplit[0];\r\n            const queryValue = querySplit[1];\r\n            otherURLQueryParams[queryKey] = queryValue;\r\n        }\r\n        else {\r\n            for (const key in queryDictionaryOrString) {\r\n                if (queryDictionaryOrString.hasOwnProperty(key)) {\r\n                    otherURLQueryParams[key] = queryDictionaryOrString[key];\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * @public\r\n     * @async\r\n     * Makes a http request with GET method\r\n     * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n     * @returns A promise that resolves to the get response\r\n     */\r\n    get(callback) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\r\n            const url = this.buildFullUrl();\r\n            const options = {\r\n                method: RequestMethod.GET,\r\n            };\r\n            try {\r\n                const response = yield this.send(url, options, callback);\r\n                return response;\r\n            }\r\n            catch (error) {\r\n                throw error;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * @public\r\n     * @async\r\n     * Makes a http request with POST method\r\n     * @param {any} content - The content that needs to be sent with the request\r\n     * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n     * @returns A promise that resolves to the post response\r\n     */\r\n    post(content, callback) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\r\n            const url = this.buildFullUrl();\r\n            const options = {\r\n                method: RequestMethod.POST,\r\n                body: serializeContent(content),\r\n                headers: typeof FormData !== \"undefined\" && content instanceof FormData\r\n                    ? {}\r\n                    : {\r\n                        \"Content-Type\": \"application/json\",\r\n                    },\r\n            };\r\n            try {\r\n                const response = yield this.send(url, options, callback);\r\n                return response;\r\n            }\r\n            catch (error) {\r\n                throw error;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * @public\r\n     * @async\r\n     * Alias for Post request call\r\n     * @param {any} content - The content that needs to be sent with the request\r\n     * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n     * @returns A promise that resolves to the post response\r\n     */\r\n    create(content, callback) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\r\n            try {\r\n                return yield this.post(content, callback);\r\n            }\r\n            catch (error) {\r\n                throw error;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * @public\r\n     * @async\r\n     * Makes http request with PUT method\r\n     * @param {any} content - The content that needs to be sent with the request\r\n     * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n     * @returns A promise that resolves to the put response\r\n     */\r\n    put(content, callback) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\r\n            const url = this.buildFullUrl();\r\n            const options = {\r\n                method: RequestMethod.PUT,\r\n                body: serializeContent(content),\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                },\r\n            };\r\n            try {\r\n                const response = yield this.send(url, options, callback);\r\n                return response;\r\n            }\r\n            catch (error) {\r\n                throw error;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * @public\r\n     * @async\r\n     * Makes http request with PATCH method\r\n     * @param {any} content - The content that needs to be sent with the request\r\n     * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n     * @returns A promise that resolves to the patch response\r\n     */\r\n    patch(content, callback) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\r\n            const url = this.buildFullUrl();\r\n            const options = {\r\n                method: RequestMethod.PATCH,\r\n                body: serializeContent(content),\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                },\r\n            };\r\n            try {\r\n                const response = yield this.send(url, options, callback);\r\n                return response;\r\n            }\r\n            catch (error) {\r\n                throw error;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * @public\r\n     * @async\r\n     * Alias for PATCH request\r\n     * @param {any} content - The content that needs to be sent with the request\r\n     * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n     * @returns A promise that resolves to the patch response\r\n     */\r\n    update(content, callback) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\r\n            try {\r\n                return yield this.patch(content, callback);\r\n            }\r\n            catch (error) {\r\n                throw error;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * @public\r\n     * @async\r\n     * Makes http request with DELETE method\r\n     * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n     * @returns A promise that resolves to the delete response\r\n     */\r\n    delete(callback) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\r\n            const url = this.buildFullUrl();\r\n            const options = {\r\n                method: RequestMethod.DELETE,\r\n            };\r\n            try {\r\n                const response = yield this.send(url, options, callback);\r\n                return response;\r\n            }\r\n            catch (error) {\r\n                throw error;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * @public\r\n     * @async\r\n     * Alias for delete request call\r\n     * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n     * @returns A promise that resolves to the delete response\r\n     */\r\n    del(callback) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\r\n            try {\r\n                return yield this.delete(callback);\r\n            }\r\n            catch (error) {\r\n                throw error;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * @public\r\n     * @async\r\n     * Makes a http request with GET method to read response as a stream.\r\n     * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n     * @returns A promise that resolves to the getStream response\r\n     */\r\n    getStream(callback) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\r\n            const url = this.buildFullUrl();\r\n            const options = {\r\n                method: RequestMethod.GET,\r\n            };\r\n            this.responseType(ResponseType.STREAM);\r\n            try {\r\n                const stream = yield this.send(url, options, callback);\r\n                return stream;\r\n            }\r\n            catch (error) {\r\n                throw error;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * @public\r\n     * @async\r\n     * Makes a http request with GET method to read response as a stream.\r\n     * @param {any} stream - The stream instance\r\n     * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n     * @returns A promise that resolves to the putStream response\r\n     */\r\n    putStream(stream, callback) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\r\n            const url = this.buildFullUrl();\r\n            const options = {\r\n                method: RequestMethod.PUT,\r\n                headers: {\r\n                    \"Content-Type\": \"application/octet-stream\",\r\n                },\r\n                body: stream,\r\n            };\r\n            try {\r\n                const response = yield this.send(url, options, callback);\r\n                return response;\r\n            }\r\n            catch (error) {\r\n                throw error;\r\n            }\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=GraphRequest.js.map"]},"metadata":{},"sourceType":"module"}